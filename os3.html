<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Web OS</title>
	<style>
		/* 基础样式 */
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			user-select: none;
			font-family: Arial, sans-serif;
		}

		/* 主题变量 */
		:root {
			--primary-color: #0078d7;
			--bg-color: #0078d7;
			--window-bg: #005a9e;
			--text-color: white;
			--taskbar-bg: rgba(0, 0, 0, 0.7);
		}

		/* 深色主题 */
		.dark-theme {
			--primary-color: #4CAF50;
			--bg-color: #1a1a1a;
			--window-bg: #2d2d2d;
			--text-color: #e0e0e0;
			--taskbar-bg: rgba(0, 0, 0, 0.9);
		}

		/* 明亮主题 */
		.light-theme {
			--primary-color: #2196F3;
			--bg-color: #f5f5f5;
			--window-bg: white;
			--text-color: #333;
			--taskbar-bg: rgba(255, 255, 255, 0.9);
		}

		body {
			background-color: var(--bg-color);
			color: var(--text-color);
			height: 100vh;
			overflow: hidden;
			background-image:
				linear-gradient(rgba(0, 0, 0, 0.1) 1px, transparent 1px),
				linear-gradient(90deg, rgba(0, 0, 0, 0.1) 1px, transparent 1px);
			background-size: 20px 20px;
			transition: background-color 0.3s, color 0.3s;
		}

		#wallpaper {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			z-index: -2;
			transition: background-image 1s ease;
		}

		.default-wallpaper {
			background-image: linear-gradient(135deg, #0078d7 0%, #004e8c 100%);
		}

		.space-wallpaper {
			background-image: url('https://source.unsplash.com/random/1920x1080/?space');
			background-size: cover;
		}

		.nature-wallpaper {
			background-image: url('https://source.unsplash.com/random/1920x1080/?nature');
			background-size: cover;
		}

		#desktop {
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 40px;
			overflow: hidden;
		}

		#taskbar {
			position: absolute;
			bottom: 0;
			left: 0;
			right: 0;
			height: 40px;
			background-color: var(--taskbar-bg);
			display: flex;
			align-items: center;
			padding: 0 10px;
			z-index: 10000;
		}

		#start-button {
			height: 30px;
			padding: 0 15px;
			background-color: var(--primary-color);
			border: none;
			color: white;
			border-radius: 3px;
			cursor: pointer;
			display: flex;
			align-items: center;
		}

		#start-button:hover {
			filter: brightness(1.2);
		}

		#start-menu {
			position: absolute;
			bottom: 40px;
			left: 10px;
			width: 300px;
			min-height: 307.4px;
			background-color: rgba(0, 0, 0, 0.8);
			border-radius: 5px 5px 0 0;
			display: none;
			flex-direction: row;
			padding: 10px;
			z-index: 1000;
			flex-wrap: wrap;
		}

		.app-icon {
			display: flex;
			flex-direction: column;
			align-items: center;
			width: 80px;
			height: 75.8px;
			margin: 10px;
			cursor: pointer;
			text-align: center;
			padding: 5px;
			border-radius: 3px;
			-webkit-user-drag: element;
			transition: transform 0.2s;
		}

		.app-icon:hover {
			background-color: rgba(255, 255, 255, 0.2);
			transform: scale(1.05);
		}

		.app-icon img {
			width: 40px;
			height: 40px;
			margin-bottom: 5px;
			-webkit-user-drag: none;
		}

		.window {
			background: var(--window-bg);
			position: absolute;
			border-radius: 5px;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
			color: var(--text-color);
			overflow: hidden;
			min-width: 300px;
			min-height: 200px;
			display: flex;
			flex-direction: column;
			resize: none;
			transition:
				left 0.2s ease-out,
				top 0.2s ease-out,
				width 0.2s ease-out,
				height 0.2s ease-out,
				transform 0.3s ease-out,
				opacity 0.3s ease-out;
		}

		.window.maximizing {
			transform: scale(0.9);
			opacity: 0;
		}

		.window.maximized {
			animation: maximize 0.3s forwards;
			border-radius: 0;
		}

		@keyframes maximize {
			0% {
				transform: scale(0.9);
				opacity: 0;
			}

			100% {
				transform: scale(1);
				opacity: 1;
			}
		}

		.window-header {
			background-color: var(--primary-color);
			color: white;
			padding: 5px 10px;
			display: flex;
			justify-content: space-between;
			align-items: center;
			cursor: move;
		}

		.window-title {
			font-size: 14px;
		}

		.window-controls button {
			background: none;
			border: none;
			color: white;
			cursor: pointer;
			padding: 0 5px;
		}

		.window-controls button:hover {
			background-color: rgba(255, 255, 255, 0.2);
		}

		.window-content {
			flex: 1;
			padding: 10px;
			overflow: auto;
			background-color: var(--bg-color);
			color: var(--text-color);
		}

		#taskbar-apps {
			display: flex;
			flex: 1;
			height: 100%;
			margin: 0 10px;
			overflow-x: auto;
		}

		.taskbar-app {
			padding: 0 10px;
			display: flex;
			align-items: center;
			cursor: pointer;
			border-radius: 3px;
			white-space: nowrap;
		}

		.taskbar-app:hover {
			background-color: rgba(255, 255, 255, 0.2);
		}

		.taskbar-app.active {
			background-color: rgba(255, 255, 255, 0.3);
		}

		#clock {
			padding: 0 10px;
			white-space: nowrap;
		}

		#app-grid {
			height: 100%;
			display: flex;
			flex-wrap: wrap;
			align-content: flex-start;
			padding: 20px;
			flex-direction: column;
		}

		/* 记事本样式 */
		.notepad-tabs {
			display: flex;
			flex-direction: column;
			height: 100%;
		}

		.tab-bar {
			display: flex;
			background: var(--primary-color);
			padding: 5px;
		}

		.tabs {
			display: flex;
			flex: 1;
			overflow-x: auto;
		}

		.tab {
			padding: 5px 15px;
			margin-right: 5px;
			background: rgba(255, 255, 255, 0.2);
			cursor: pointer;
			color: white;
			white-space: nowrap;
		}

		.tab.active {
			background: white;
			color: var(--primary-color);
		}

		.tab-content {
			flex: 1;
			position: relative;
		}

		.notepad-content {
			width: 100%;
			height: 100%;
			border: none;
			resize: none;
			padding: 10px;
			display: none;
			background-color: white;
			color: black;
		}

		.notepad-content.active {
			display: block;
		}

		/* 计算器样式 */
		.calculator {
			display: grid;
			grid-template-columns: repeat(4, 1fr);
			gap: 5px;
			padding: 10px;
		}

		.calculator-display {
			grid-column: span 4;
			height: 40px;
			text-align: right;
			padding: 5px 10px;
			background-color: #f0f0f0;
			border: 1px solid #ccc;
			margin-bottom: 5px;
			color: black;
		}

		.calculator button {
			height: 40px;
			border: 1px solid #ccc;
			background-color: #f8f8f8;
			cursor: pointer;
			color: black;
		}

		.calculator button:hover {
			background-color: #e0e0e0;
		}

		.calculator button.operator {
			background-color: #f0a830;
			color: white;
		}

		.calculator button.operator:hover {
			background-color: #e09020;
		}

		/* 文件管理器样式 */
		.file-manager {
			display: flex;
			height: 100%;
		}

		.fm-toolbar {
			padding: 10px;
			background: #f0f0f0;
			display: flex;
			flex-direction: column;
			gap: 5px;
		}

		.fm-toolbar button {
			padding: 5px;
			cursor: pointer;
		}

		.fm-sidebar {
			width: 200px;
			background: #e0e0e0;
			padding: 10px;
			color: black;
		}

		.fm-content {
			flex: 1;
			padding: 10px;
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
			gap: 10px;
			overflow: auto;
		}

		.fm-file {
			display: flex;
			flex-direction: column;
			align-items: center;
			padding: 5px;
			cursor: pointer;
			background: rgba(255, 255, 255, 0.7);
			border-radius: 5px;
			color: black;
		}

		.fm-file img {
			width: 40px;
			height: 40px;
			margin-bottom: 5px;
		}

		/* 设置应用样式 */
		.settings-content {
			padding: 10px;
		}

		.settings-content button {
			padding: 8px 12px;
			margin: 5px;
			background: var(--primary-color);
			color: white;
			border: none;
			border-radius: 3px;
			cursor: pointer;
		}

		/* 响应式设计 */
		@media (max-width: 768px) {
			.app-icon {
				width: 60px;
				height: 60px;
				font-size: 12px;
			}

			.window {
				min-width: 280px !important;
				width: 90% !important;
				left: 5% !important;
			}

			#start-menu {
				width: 250px;
			}

			#taskbar {
				height: 50px;
			}

			.taskbar-app {
				padding: 0 5px;
				font-size: 12px;
			}

			#clock {
				font-size: 12px;
			}

			.fm-sidebar {
				width: 150px;
			}
		}

		@media (max-width: 480px) {
			.app-icon {
				width: 50px;
				margin: 5px;
			}

			#app-grid {
				padding: 10px;
			}

			.file-manager {
				flex-direction: column;
			}

			.fm-sidebar {
				width: 100%;
			}
		}

		/* 窗口调整大小手柄 */
		.resize-handle {
			position: absolute;
			right: 0;
			bottom: 0;
			width: 15px;
			height: 15px;
			cursor: nwse-resize;
			background: linear-gradient(135deg, #ccc 50%, transparent 50%);
		}

		.resize-handle:hover {
			background: linear-gradient(135deg, var(--primary-color) 50%, transparent 50%);
		}

		.window.maximized .resize-handle {
			display: none;
		}

		/* 拖动相关样式 */
		.dragging {
			opacity: 0.8;
			transform: scale(1.05);
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
		}

		.drag-placeholder {
			background-color: rgba(255, 255, 255, 0.2);
			border: 2px dashed rgba(255, 255, 255, 0.5);
		}
	</style>
</head>

<body>
	<div id="wallpaper" class="default-wallpaper"></div>
	<div id="desktop">
		<div id="app-grid">
			<div class="app-icon" onclick="openApp('notepad')">
				<img src="data:image/svg+xml;base64,PHN2ZyB0PSIxNzQ0NTQ2ODgyMDM2IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM1OTQiIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48cGF0aCBkPSJNODM4LjkgNjRIMjgyLjRjLTQ5LjIgMC04OS4xIDQwLjItODkuMSA4OS42djg5LjZIOTZ2NTkuN2g5Ny4ydjU5LjdIOTZ2NTkuN2g5Ny4yVjQ4Mkg5NnY1OS43aDk3LjJ2NTkuN0g5NnY1OS43aDk3LjJ2MjA5LjFjMCA0OS40IDQwIDg5LjYgODkuMSA4OS42aDU1Ni41YzQ5LjIgMCA4OS4xLTQwLjIgODkuMS04OS42VjE1My42YzAuMS00OS40LTM5LjktODkuNi04OS04OS42eiBtMjkuNyA4MDYuNGMwIDE2LjUtMTMuMyAyOS45LTI5LjcgMjkuOUgyODIuNGMtMTYuNCAwLTI5LjctMTMuNC0yOS43LTI5LjlWNjYxLjNoNTkuNHYtNTkuN2gtNTkuNHYtNTkuN2g1OS40di01OS43aC01OS40di01OS43aDU5LjR2LTU5LjdoLTU5LjR2LTU5LjdoNTkuNHYtNTkuN2gtNTkuNHYtODkuNmMwLTE2LjUgMTMuMy0yOS45IDI5LjctMjkuOWg1NTYuNWMxNi40IDAgMjkuNyAxMy40IDI5LjcgMjkuOXY3MTYuNnoiIGZpbGw9IndoaXRlIiBwLWlkPSIzNTk1Ij48L3BhdGg+PHBhdGggZD0iTTM4MS41IDE4My41aDQyNy43djIzOC45SDM4MS41eiIgZmlsbD0id2hpdGUiIHAtaWQ9IjM1OTYiPjwvcGF0aD48L3N2Zz4="
					alt="记事本">
				<span>记事本</span>
			</div>
			<div class="app-icon" onclick="openApp('calculator')">
				<img src="data:image/svg+xml;base64,PHN2ZyB0PSIxNzQ0NDcwOTM3NTQyIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI4NjkiDQoJd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiPg0KCTxwYXRoDQoJCWQ9Ik04MDAgNjRIMjI0Yy0xNy42IDAtMzIgMTQuNC0zMiAzMnY4MzJjMCAxNy42IDE0LjQgMzIgMzIgMzJoNTc2YzE3LjYgMCAzMi0xNC40IDMyLTMyVjk2YzAtMTcuNi0xNC40LTMyLTMyLTMyeiBtLTQxNiA3NjhoLTY0di02NGg2NHY2NHogbTAtMTYwaC02NHYtNjRoNjR2NjR6IG0wLTE2MGgtNjR2LTY0aDY0djY0eiBtMTYwIDMyMGgtNjR2LTY0aDY0djY0eiBtMC0xNjBoLTY0di02NGg2NHY2NHogbTAtMTYwaC02NHYtNjRoNjR2NjR6IG0xNjAgMzIwaC02NHYtNjRoNjR2NjR6IG0wLTE2MGgtNjR2LTY0aDY0djY0eiBtMC0xNjBoLTY0di02NGg2NHY2NHogbTAtMTkySDMyMFYxOTJoMzg0djEyOHoiDQoJCXAtaWQ9IjI4NzAiIGZpbGw9IndoaXRlIj48L3BhdGg+DQo8L3N2Zz4="
					alt="计算器">
				<span>计算器</span>
			</div>
			<div class="app-icon" onclick="openApp('filemanager')">
				<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBkPSJNNDE2IDIxMmMwLTU4LjktNDcuMS0xMDYtMTA2LTEwNkgxMDRDNDUuMSAxMDYgMCAxNTMuMSAwIDIxMnYyMDBjMCA1OC45IDQ1LjEgMTA2IDEwNCAxMDZoMzA2YzU4LjkgMCAxMDYtNDcuMSAxMDYtMTA2VjIxMnoiIGZpbGw9IiNmZmYiIG9wYWNpdHk9Ii40Ii8+PHBhdGggZD0iTTQxNiAyMTJjMC01OC45LTQ3LjEtMTA2LTEwNi0xMDZIMjIydjMxMmgzMDRjNTguOSAwIDEwNi00Ny4xIDEwNi0xMDZWMjEyeiIgZmlsbD0iI2ZmZiIvPjwvc3ZnPg=="
					alt="文件管理器">
				<span>文件管理器</span>
			</div>
			<div class="app-icon" onclick="openApp('settings')">
				<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBkPSJNNDk0LjEgMzUxLjRMMzY1LjkgMjU2bDEyOC4yLTk1LjRjMTMuNy0xMC4yIDE2LjctMjkuMiA2LjUtNDIuOWwtLTkuOS0xMy4yYy0xMC4yLTEzLjctMjkuMi0xNi43LTQyLjktNi41TDMyMCAxOTIuN1Y1NmMwLTE1LjUtMTIuNS0yOC0yOC0yOGgtMTZjLTE1LjUgMC0yOCAxMi41LTI4IDI4djEzNi43TDE2Mi4yIDEwMC4xYy0xMy43LTEwLjItMzIuNy03LjItNDIuOSA2LjVsLTkuOSAxMy4yYy0xMC4yIDEzLjctNy4yIDMyLjcgNi41IDQyLjlMMTQ2LjEgMjU2IDE3LjkgMzUxLjRjLTEzLjcgMTAuMi0xNi43IDI5LjItNi41IDQyLjlsOS45IDEzLjJjMTAuMiAxMy43IDI5LjIgMTYuNyA0Mi45IDYuNUwxOTIgMzE5LjNWNDU2YzAgMTUuNSAxMi41IDI4IDI4IDI4aDE2YzE1LjUgMCAyOC0xMi41IDI4LTI4VjMxOS4zbDExNy43IDg4LjNjMTMuNyAxMC4yIDMyLjcgNy4yIDQyLjktNi41bDkuOS0xMy4yYzEwLjItMTMuNyA3LjItMzIuNy02LjUtNDIuOXoiIGZpbGw9IiNmZmYiLz48L3N2Zz4="
					alt="设置">
				<span>设置</span>
			</div>
		</div>

		<!-- 窗口容器 -->
		<div id="windows-container"></div>
	</div>

	<div id="taskbar">
		<button id="start-button" onclick="toggleStartMenu()">开始</button>
		<div id="start-menu">
			<div class="app-icon" onclick="openApp('notepad')">
				<img src="data:image/svg+xml;base64,PHN2ZyB0PSIxNzQ0NTQ2ODgyMDM2IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM1OTQiIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48cGF0aCBkPSJNODM4LjkgNjRIMjgyLjRjLTQ5LjIgMC04OS4xIDQwLjItODkuMSA4OS42djg5LjZIOTZ2NTkuN2g5Ny4ydjU5LjdIOTZ2NTkuN2g5Ny4yVjQ4Mkg5NnY1OS43aDk3LjJ2NTkuN0g5NnY1OS43aDk3LjJ2MjA5LjFjMCA0OS40IDQwIDg5LjYgODkuMSA4OS42aDU1Ni41YzQ5LjIgMCA4OS4xLTQwLjIgODkuMS04OS42VjE1My42YzAuMS00OS40LTM5LjktODkuNi04OS04OS42eiBtMjkuNyA4MDYuNGMwIDE2LjUtMTMuMyAyOS45LTI5LjcgMjkuOUgyODIuNGMtMTYuNCAwLTI5LjctMTMuNC0yOS43LTI5LjlWNjYxLjNoNTkuNHYtNTkuN2gtNTkuNHYtNTkuN2g1OS40di01OS43aC01OS40di01OS43aDU5LjR2LTU5LjdoLTU5LjR2LTU5LjdoNTkuNHYtNTkuN2gtNTkuNHYtODkuNmMwLTE2LjUgMTMuMy0yOS45IDI5LjctMjkuOWg1NTYuNWMxNi40IDAgMjkuNyAxMy40IDI5LjcgMjkuOXY3MTYuNnoiIGZpbGw9IndoaXRlIiBwLWlkPSIzNTk1Ij48L3BhdGg+PHBhdGggZD0iTTM4MS41IDE4My41aDQyNy43djIzOC45SDM4MS41eiIgZmlsbD0id2hpdGUiIHAtaWQ9IjM1OTYiPjwvcGF0aD48L3N2Zz4="
					alt="记事本">
				<span>记事本</span>
			</div>
			<div class="app-icon" onclick="openApp('calculator')">
				<img src="data:image/svg+xml;base64,PHN2ZyB0PSIxNzQ0NDcwOTM3NTQyIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI4NjkiDQoJd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiPg0KCTxwYXRoDQoJCWQ9Ik04MDAgNjRIMjI0Yy0xNy42IDAtMzIgMTQuNC0zMiAzMnY4MzJjMCAxNy42IDE0LjQgMzIgMzIgMzJoNTc2YzE3LjYgMCAzMi0xNC40IDMyLTMyVjk2YzAtMTcuNi0xNC40LTMyLTMyLTMyeiBtLTQxNiA3NjhoLTY0di02NGg2NHY2NHogbTAtMTYwaC02NHYtNjRoNjR2NjR6IG0wLTE2MGgtNjR2LTY0aDY0djY0eiBtMTYwIDMyMGgtNjR2LTY0aDY0djY0eiBtMC0xNjBoLTY0di02NGg2NHY2NHogbTAtMTYwaC02NHYtNjRoNjR2NjR6IG0xNjAgMzIwaC02NHYtNjRoNjR2NjR6IG0wLTE2MGgtNjR2LTY0aDY0djY0eiBtMC0xNjBoLTY0di02NGg2NHY2NHogbTAtMTkySDMyMFYxOTJoMzg0djEyOHoiDQoJCXAtaWQ9IjI4NzAiIGZpbGw9IndoaXRlIj48L3BhdGg+DQo8L3N2Zz4="
					alt="计算器">
				<span>计算器</span>
			</div>
			<div class="app-icon" onclick="openApp('filemanager')">
				<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBkPSJNNDE2IDIxMmMwLTU4LjktNDcuMS0xMDYtMTA2LTEwNkgxMDRDNDUuMSAxMDYgMCAxNTMuMSAwIDIxMnYyMDBjMCA1OC45IDQ1LjEgMTA2IDEwNCAxMDZoMzA2YzU4LjkgMCAxMDYtNDcuMSAxMDYtMTA2VjIxMnoiIGZpbGw9IiNmZmYiIG9wYWNpdHk9Ii40Ii8+PHBhdGggZD0iTTQxNiAyMTJjMC01OC45LTQ3LjEtMTA2LTEwNi0xMDZIMjIydjMxMmgzMDRjNTguOSAwIDEwNi00Ny4xIDEwNi0xMDZWMjEyeiIgZmlsbD0iI2ZmZiIvPjwvc3ZnPg=="
					alt="文件管理器">
				<span>文件管理器</span>
			</div>
			<div class="app-icon" onclick="openApp('settings')">
				<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBkPSJNNDk0LjEgMzUxLjRMzY1LjkgMjU2bDEyOC4yLTk1LjRjMTMuNy0xMC4yIDE2LjctMjkuMiA2LjUtNDIuOWwtLTkuOS0xMy4yYy0xMC4yLTEzLjctMjkuMi0xNi43LTQyLjktNi41TDMyMCAxOTIuN1Y1NmMwLTE1LjUtMTIuNS0yOC0yOC0yOGgtMTZjLTE1LjUgMC0yOCAxMi41LTI4IDI4djEzNi43TDE2Mi4yIDEwMC4xYy0xMy43LTEwLjItMzIuNy03LjItNDIuOSA2LjVsLTkuOSAxMy4yYy0xMC4yIDEzLjctNy4yIDMyLjcgNi41IDQyLjlMMTQ2LjEgMjU2IDE3LjkgMzUxLjRjLTEzLjcgMTAuMi0xNi43IDI5LjItNi41IDQyLjlsOS45IDEzLjJjMTAuMiAxMy43IDI5LjIgMTYuNyA0Mi45IDYuNUwxOTIgMzE5LjNWNDU2YzAgMTUuNSAxMi41IDI4IDI4IDI4aDE2YzE1LjUgMCAyOC0xMi41IDI4LTI4VjMxOS4zbDExNy43IDg4LjNjMTMuNyAxMC4yIDMyLjcgNy4yIDQyLjktNi41bDkuOS0xMy4yYzEwLjItMTMuNyA3LjItMzIuNy02LjUtNDIuOXoiIGZpbGw9IiNmZmYiLz48L3N2Zz4="
					alt="设置">
				<span>设置</span>
			</div>
		</div>

		<div id="taskbar-apps"></div>
		<div id="clock">1900年1月1日00:00:00</div>
	</div>

	<script>
		// 全局变量
		let windows = [];
		let activeWindow = null;
		let zIndex = 100;
		let isDragging = false;
		let dragOffsetX, dragOffsetY;
		let dragWindow;
		let isResizing = false;
		let initialWidth, initialHeight, initialMouseX, initialMouseY;
		let windowStates = {};
		let isAppDragging = false;
		let draggedApp = null;
		let dragStartX, dragStartY;

		// 文件系统数据
		let fileSystem = {
			root: {
				name: '本地磁盘',
				type: 'folder',
				children: [
					{ name: '文档', type: 'folder', children: [] },
					{ name: '图片', type: 'folder', children: [] },
					{ name: '下载', type: 'folder', children: [] }
				]
			}
		};

		// 记事本标签页数据
		let notepadTabs = [];
		let activeNotepadTab = null;

		// 初始化
		document.addEventListener('DOMContentLoaded', function () {
			restoreState();
			updateClock();
			setInterval(updateClock, 1000);

			// 关闭开始菜单当点击其他地方时
			document.addEventListener('click', function (e) {
				if (!e.target.closest('#start-button') && !e.target.closest('#start-menu')) {
					document.getElementById('start-menu').style.display = 'none';
				}
			});

			// 为桌面图标添加拖动事件
			document.querySelectorAll('#desktop #app-grid .app-icon').forEach(icon => {
				icon.addEventListener('mousedown', startAppDrag);
			});

			document.addEventListener('mousemove', dragApp);
			document.addEventListener('mouseup', stopAppDrag);

			// 键盘快捷键监听
			document.addEventListener('keydown', function (e) {
				// Alt+Tab切换窗口
				if (e.altKey && e.key === 'Tab') {
					e.preventDefault();
					if (windows.length > 1) {
						const currentIndex = windows.findIndex(w => w.id === activeWindow?.id);
						const nextIndex = (currentIndex + 1) % windows.length;
						focusWindow(windows[nextIndex].id);
					}
				}

				// Ctrl+N新建记事本
				if (e.ctrlKey && e.key === 'n') {
					e.preventDefault();
					openApp('notepad');
				}

				// Ctrl+Q关闭当前窗口
				if (e.ctrlKey && e.key === 'q') {
					e.preventDefault();
					if (activeWindow) closeWindow(activeWindow.id);
				}

				// Ctrl+Shift+D显示桌面
				if (e.ctrlKey && e.shiftKey && e.key === 'd') {
					e.preventDefault();
					windows.forEach(w => minimizeWindow(w.id));
				}
			});
		});

		// 保存状态到localStorage
		function saveState() {
			const state = {
				windows: windows.map(windowObj => ({
					id: windowObj.id,
					appName: windowObj.appName,
					title: windowObj.title,
					left: windowObj.element.style.left,
					top: windowObj.element.style.top,
					width: windowObj.element.style.width,
					height: windowObj.element.style.height,
					minimized: windowObj.minimized,
					maximized: windowObj.maximized
				})),
				activeWindow: activeWindow ? activeWindow.id : null,
				zIndex,
				windowStates,
				appIcons: Array.from(document.querySelectorAll('#desktop #app-grid .app-icon')).map(icon => ({
					appName: icon.querySelector('span').textContent,
					left: icon.offsetLeft,
					top: icon.offsetTop
				})),
				theme: document.body.className,
				wallpaper: document.getElementById('wallpaper').className.replace('-wallpaper', ''),
				notepadContents: {}
			};

			// 保存记事本内容
			document.querySelectorAll('.notepad-content').forEach((textarea, index) => {
				if (textarea.id) {
					state.notepadContents[textarea.id] = textarea.value;
				}
			});

			localStorage.setItem('webOSState', JSON.stringify(state));
		}

		// 从localStorage恢复状态
		function restoreState() {
			const savedState = localStorage.getItem('webOSState');
			if (savedState) {
				const state = JSON.parse(savedState);
				zIndex = state.zIndex || 100;
				windowStates = state.windowStates || {};

				// 恢复主题
				if (state.theme) {
					document.body.className = state.theme;
				}

				// 恢复壁纸
				if (state.wallpaper) {
					changeWallpaper(state.wallpaper);
				}

				// 恢复窗口
				if (state.windows) {
					state.windows.forEach(windowData => {
						openApp(windowData.appName, false);
						const windowObj = windows.find(w => w.id === windowData.id);
						if (windowObj) {
							windowObj.element.style.left = windowData.left;
							windowObj.element.style.top = windowData.top;
							windowObj.element.style.width = windowData.width;
							windowObj.element.style.height = windowData.height;
							windowObj.minimized = windowData.minimized;
							windowObj.maximized = windowData.maximized;
							if (windowObj.maximized) {
								maximizeWindow(windowData.id);
							}
							if (windowObj.minimized) {
								minimizeWindow(windowData.id);
							}
						}
					});
				}

				// 恢复活动窗口
				if (state.activeWindow) {
					focusWindow(state.activeWindow);
				}

				// 恢复记事本内容
				if (state.notepadContents) {
					Object.keys(state.notepadContents).forEach(id => {
						const textarea = document.getElementById(id);
						if (textarea) {
							textarea.value = state.notepadContents[id];
						}
					});
				}

				// 恢复图标位置
				if (state.appIcons) {
					state.appIcons.forEach(iconData => {
						const icon = Array.from(document.querySelectorAll('#desktop #app-grid .app-icon')).find(
							icon => icon.querySelector('span').textContent === iconData.appName
						);
						if (icon && iconData.left && iconData.top) {
							icon.style.position = 'absolute';
							icon.style.left = `${iconData.left}px`;
							icon.style.top = `${iconData.top}px`;
						}
					});
				}
			}
		}

		// 页面关闭时保存状态
		window.addEventListener('beforeunload', saveState);

		// 开始拖动应用图标
		function startAppDrag(e) {
			// 检查是否按下鼠标中键（button 属性值为 1 表示中键）
			if (e.button !== 1) return;
			isAppDragging = true;
			draggedApp = e.target.closest('.app-icon');
			dragStartX = e.clientX - draggedApp.offsetLeft;
			dragStartY = e.clientY - draggedApp.offsetTop;
			draggedApp.classList.add('dragging');
			e.preventDefault();
		}

		// 拖动应用图标
		function dragApp(e) {
			if (isAppDragging && draggedApp) {
				let left = e.clientX - dragStartX;
				let top = e.clientY - dragStartY;

				// 边界检查
				const maxLeft = window.innerWidth - draggedApp.offsetWidth;
				const maxTop = window.innerHeight - draggedApp.offsetHeight - 40; // 减去任务栏高度

				left = Math.max(0, Math.min(left, maxLeft));
				top = Math.max(0, Math.min(top, maxTop));

				draggedApp.style.position = 'absolute';
				draggedApp.style.left = `${left}px`;
				draggedApp.style.top = `${top}px`;
			}
		}

		// 停止拖动应用图标
		function stopAppDrag() {
			if (isAppDragging && draggedApp) {
				draggedApp.classList.remove('dragging');
				isAppDragging = false;
				draggedApp = null;
			}
		}

		// 更新时钟
		function updateClock() {
			const now = new Date();
			const timeStr = now.getFullYear() + '年' + (now.getMonth() + 1) + '月' + now.getDate() + '日 ' +
				now.toLocaleTimeString('zh-CN', { hour12: false });
			document.getElementById('clock').textContent = timeStr;
		}

		// 切换开始菜单
		function toggleStartMenu() {
			const menu = document.getElementById('start-menu');
			menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
		}

		// 打开应用
		function openApp(appName, focus = true) {
			// 关闭开始菜单
			document.getElementById('start-menu').style.display = 'none';

			// 检查是否已经打开
			const existingWindow = windows.find(w => w.appName === appName && !w.minimized);
			if (existingWindow) {
				if (focus) focusWindow(existingWindow.id);
				return;
			}

			// 创建新窗口
			const windowId = 'window-' + Date.now();
			const windowElement = document.createElement('div');
			windowElement.className = 'window';
			windowElement.id = windowId;
			windowElement.style.zIndex = zIndex++;

			let windowContent = '';
			let windowTitle = '';

			switch (appName) {
				case 'notepad':
					windowTitle = '记事本';
					windowContent = `
                        <div class="notepad-tabs">
                            <div class="tab-bar">
                                <button onclick="notepadNewTab()">+</button>
                                <div class="tabs" id="notepad-tabs"></div>
                            </div>
                            <div class="tab-content" id="notepad-contents"></div>
                        </div>
                    `;
					notepadNewTab();
					break;

				case 'calculator':
					windowTitle = '计算器';
					windowContent = `
                        <div class="calculator">
                            <div class="calculator-display" id="calc-display">0</div>
                            <button onclick="calcInput('7')">7</button>
                            <button onclick="calcInput('8')">8</button>
                            <button onclick="calcInput('9')">9</button>
                            <button class="operator" onclick="calcInput('+')">+</button>
                            <button onclick="calcInput('4')">4</button>
                            <button onclick="calcInput('5')">5</button>
                            <button onclick="calcInput('6')">6</button>
                            <button class="operator" onclick="calcInput('-')">-</button>
                            <button onclick="calcInput('1')">1</button>
                            <button onclick="calcInput('2')">2</button>
                            <button onclick="calcInput('3')">3</button>
                            <button class="operator" onclick="calcInput('*')">×</button>
                            <button onclick="calcInput('0')">0</button>
                            <button onclick="calcInput('.')">.</button>
                            <button onclick="calcClear()">C</button>
                            <button class="operator" onclick="calcInput('/')">÷</button>
                            <button class="operator" style="grid-column: span 4;" onclick="calcCalculate()">=</button>
                        </div>
                    `;
					break;

				case 'filemanager':
					windowTitle = '文件管理器';
					windowContent = `
                        <div class="file-manager">
                            <div class="fm-toolbar">
                                <button onclick="fmCreateFolder()">新建文件夹</button>
                                <button onclick="fmUploadFile()">上传文件</button>
                            </div>
                            <div class="fm-sidebar">
                                <div class="fm-drive" onclick="fmRenderFiles([])">本地存储</div>
                            </div>
                            <div class="fm-content" id="fm-files"></div>
                        </div>
                    `;
					fmRenderFiles([]);
					break;

				case 'settings':
					windowTitle = '系统设置';
					windowContent = `
                        <div class="settings-content">
                            <h3>壁纸设置</h3>
                            <button onclick="changeWallpaper('default')">默认壁纸</button>
                            <button onclick="changeWallpaper('space')">星空壁纸</button>
                            <button onclick="changeWallpaper('nature')">自然风景</button>
                            
                            <h3>主题设置</h3>
                            <button onclick="changeTheme('')">默认主题</button>
                            <button onclick="changeTheme('dark-theme')">深色主题</button>
                            <button onclick="changeTheme('light-theme')">明亮主题</button>
                        </div>
                    `;
					break;

				default:
					windowTitle = appName;
					windowContent = `<p>${appName} 应用内容</p>`;
			}

			windowElement.innerHTML = `
                <div class="window-header" onmousedown="startDrag(event, '${windowId}')">
                    <div class="window-title">${windowTitle}</div>
                    <div class="window-controls">
                        <button onclick="minimizeWindow('${windowId}')">-</button>
                        <button onclick="toggleMaximizeWindow('${windowId}')">□</button>
                        <button onclick="closeWindow('${windowId}')">×</button>
                    </div>
                </div>
                <div class="window-content">
                    ${windowContent}
                </div>
                <div class="resize-handle" onmousedown="startResize(event, '${windowId}')"></div>
            `;

			// 随机位置
			const left = Math.floor(Math.random() * (window.innerWidth - 300));
			const top = Math.floor(Math.random() * (window.innerHeight - 300 - 40)); // 减去任务栏高度

			windowElement.style.left = `${left}px`;
			windowElement.style.top = `${top}px`;

			document.getElementById('windows-container').appendChild(windowElement);

			// 添加到窗口列表
			const windowObj = {
				id: windowId,
				appName: appName,
				title: windowTitle,
				element: windowElement,
				minimized: false,
				maximized: false
			};

			windows.push(windowObj);

			// 添加到任务栏
			addToTaskbar(windowObj);

			// 聚焦窗口
			if (focus) focusWindow(windowId);

			// 窗口拖动功能
			setupDrag(windowElement, windowId);
		}

		// 添加到任务栏
		function addToTaskbar(windowObj) {
			const taskbarApps = document.getElementById('taskbar-apps');
			const appElement = document.createElement('div');
			appElement.className = 'taskbar-app';
			appElement.textContent = windowObj.title;
			appElement.dataset.windowId = windowObj.id;

			appElement.onclick = function () {
				const windowId = this.dataset.windowId;
				const windowObj = windows.find(w => w.id === windowId);

				if (windowObj.minimized) {
					restoreWindow(windowId);
				} else {
					focusWindow(windowId);
				}
			};

			taskbarApps.appendChild(appElement);
			windowObj.taskbarElement = appElement;
		}

		// 聚焦窗口
		function focusWindow(windowId) {
			const windowObj = windows.find(w => w.id === windowId);
			if (!windowObj) return;

			// 更新z-index
			windowObj.element.style.zIndex = zIndex++;

			// 更新活动窗口
			if (activeWindow) {
				activeWindow.element.style.boxShadow = '0 0 10px rgba(0, 0, 0, 0.5)';
				const activeTaskbarApp = document.querySelector('.taskbar-app.active');
				if (activeTaskbarApp) {
					activeTaskbarApp.classList.remove('active');
				}
			}

			activeWindow = windowObj;
			windowObj.element.style.boxShadow = '0 0 15px rgba(0, 0, 0, 0.7)';

			// 更新任务栏
			const taskbarApp = document.querySelector(`.taskbar-app[data-window-id="${windowId}"]`);
			if (taskbarApp) {
				taskbarApp.classList.add('active');
			}

			// 确保窗口可见
			if (windowObj.minimized) {
				restoreWindow(windowId);
			}
		}

		// 设置窗口拖动
		function setupDrag(element, windowId) {
			const header = element.querySelector('.window-header');

			header.addEventListener('mousedown', function (e) {
				// 如果窗口是最大化的，双击标题栏还原
				if (e.detail > 1) { // 双击
					toggleMaximizeWindow(windowId);
					return;
				}
				startDrag(e, windowId);
			});
		}

		// 开始拖动
		function startDrag(e, windowId) {
			const windowObj = windows.find(w => w.id === windowId);
			if (!windowObj) return;

			// 如果窗口是最大化的，先还原
			if (windowObj.maximized) {
				restoreWindowSize(windowId);
				// 调整偏移量，使窗口跟随鼠标
				dragOffsetX = e.clientX * (parseInt(windowObj.element.style.width) / window.innerWidth);
				dragOffsetY = e.clientY * (parseInt(windowObj.element.style.height) / (window.innerHeight - 40));
				return;
			}

			isDragging = true;
			dragWindow = windowObj.element;

			// 计算鼠标相对于窗口的偏移
			const rect = dragWindow.getBoundingClientRect();
			dragOffsetX = e.clientX - rect.left;
			dragOffsetY = e.clientY - rect.top;

			// 聚焦窗口
			focusWindow(windowId);

			// 添加全局事件监听器
			document.addEventListener('mousemove', drag);
			document.addEventListener('mouseup', stopDrag);

			e.preventDefault();
		}

		// 拖动中
		function drag(e) {
			if (isDragging) {
				// 计算新位置
				let left = e.clientX - dragOffsetX;
				let top = e.clientY - dragOffsetY;

				// 限制在视口内
				const maxLeft = window.innerWidth - dragWindow.offsetWidth;
				const maxTop = window.innerHeight - dragWindow.offsetHeight - 40; // 减去任务栏高度

				left = Math.max(0, Math.min(left, maxLeft));
				top = Math.max(0, Math.min(top, maxTop));

				// 贴边检测
				const snapThreshold = 20; // 贴边阈值
				const winWidth = dragWindow.offsetWidth;
				const winHeight = dragWindow.offsetHeight;

				// 左侧贴边
				if (left <= snapThreshold) {
					left = 0;
					// 如果同时满足顶部/底部条件，可以半屏
					if (top <= snapThreshold) {
						// 左上角
						top = 0;
						dragWindow.style.height = '50%';
					} else if (top + winHeight >= window.innerHeight - snapThreshold - 40) {
						// 左下角
						top = window.innerHeight - 40 - winHeight;
						dragWindow.style.height = '50%';
					}
				}
				// 右侧贴边
				else if (left + winWidth >= window.innerWidth - snapThreshold) {
					left = window.innerWidth - winWidth;
					// 右上角/右下角判断类似左侧
					if (top <= snapThreshold) {
						// 右上角
						top = 0;
						dragWindow.style.height = '50%';
					} else if (top + winHeight >= window.innerHeight - snapThreshold - 40) {
						// 右下角
						top = window.innerHeight - 40 - winHeight;
						dragWindow.style.height = '50%';
					}
				}

				// 顶部贴边 (全屏)
				if (top <= snapThreshold) {
					top = 0;
					dragWindow.style.height = '100%';
				}

				dragWindow.style.left = `${left}px`;
				dragWindow.style.top = `${top}px`;
			} else if (isResizing) {
				// 计算新大小
				const width = initialWidth + (e.clientX - initialMouseX);
				const height = initialHeight + (e.clientY - initialMouseY);

				// 限制最小和最大尺寸
				const minWidth = parseInt(dragWindow.style.minWidth) || 300;
				const minHeight = parseInt(dragWindow.style.minHeight) || 200;
				const maxWidth = window.innerWidth - parseInt(dragWindow.style.left);
				const maxHeight = window.innerHeight - parseInt(dragWindow.style.top) - 40; // 减去任务栏高度

				const newWidth = Math.max(minWidth, Math.min(width, maxWidth));
				const newHeight = Math.max(minHeight, Math.min(height, maxHeight));

				dragWindow.style.width = `${newWidth}px`;
				dragWindow.style.height = `${newHeight}px`;
			}
		}

		// 停止拖动
		function stopDrag() {
			isDragging = false;
			isResizing = false;
			dragWindow = null;

			// 移除全局事件监听器
			document.removeEventListener('mousemove', drag);
			document.removeEventListener('mouseup', stopDrag);
		}

		// 最小化窗口
		function minimizeWindow(windowId) {
			const windowObj = windows.find(w => w.id === windowId);
			if (!windowObj) return;

			windowObj.element.style.display = 'none';
			windowObj.minimized = true;

			// 更新任务栏
			if (windowObj.taskbarElement) {
				windowObj.taskbarElement.classList.remove('active');
			}

			// 如果最小化的是活动窗口，清除活动窗口
			if (activeWindow && activeWindow.id === windowId) {
				activeWindow = null;
			}
		}

		// 恢复窗口
		function restoreWindow(windowId) {
			const windowObj = windows.find(w => w.id === windowId);
			if (!windowObj) return;

			windowObj.element.style.display = 'flex';
			windowObj.minimized = false;

			focusWindow(windowId);
		}

		// 关闭窗口
		function closeWindow(windowId) {
			const windowObj = windows.find(w => w.id === windowId);
			if (!windowObj) return;

			// 从DOM移除
			windowObj.element.remove();

			// 从任务栏移除
			if (windowObj.taskbarElement) {
				windowObj.taskbarElement.remove();
			}

			// 从窗口列表移除
			windows = windows.filter(w => w.id !== windowId);

			// 如果关闭的是活动窗口，清除活动窗口
			if (activeWindow && activeWindow.id === windowId) {
				activeWindow = null;
			}

			// 从窗口状态存储中移除
			delete windowStates[windowId];
		}

		// 切换窗口最大化状态
		function toggleMaximizeWindow(windowId) {
			const windowObj = windows.find(w => w.id === windowId);
			if (!windowObj) return;

			if (windowObj.maximized) {
				// 还原窗口
				restoreWindowSize(windowId);
			} else {
				// 最大化窗口
				maximizeWindow(windowId);
			}
		}

		// 还原窗口大小
		function restoreWindowSize(windowId) {
			const windowObj = windows.find(w => w.id === windowId);
			if (!windowObj || !windowObj.maximized) return;

			// 移除最大化类
			windowObj.element.classList.remove('maximized');
			windowObj.maximized = false;

			// 恢复之前的状态
			const state = windowStates[windowId];
			if (state) {
				windowObj.element.style.left = state.left;
				windowObj.element.style.top = state.top;
				windowObj.element.style.width = state.width;
				windowObj.element.style.height = state.height;
			}

			// 聚焦窗口
			focusWindow(windowId);
		}

		// 最大化窗口
		function maximizeWindow(windowId) {
			const windowObj = windows.find(w => w.id === windowId);
			if (!windowObj || windowObj.maximized) return;

			// 保存当前窗口状态
			windowStates[windowId] = {
				left: windowObj.element.style.left,
				top: windowObj.element.style.top,
				width: windowObj.element.style.width,
				height: windowObj.element.style.height
			};

			// 添加最大化动画
			windowObj.element.classList.add('maximizing');

			setTimeout(() => {
				windowObj.element.classList.remove('maximizing');
				windowObj.element.classList.add('maximized');
				windowObj.maximized = true;

				// 设置最大化位置和尺寸
				windowObj.element.style.left = '0';
				windowObj.element.style.top = '0';
				windowObj.element.style.width = '100%';
				windowObj.element.style.height = 'calc(100% - 40px)';

				// 聚焦窗口
				focusWindow(windowId);
			}, 100);
		}

		// 开始调整大小
		function startResize(e, windowId) {
			const windowObj = windows.find(w => w.id === windowId);
			if (!windowObj || windowObj.maximized) return;

			isResizing = true;
			dragWindow = windowObj.element;

			// 记录初始状态
			initialWidth = dragWindow.offsetWidth;
			initialHeight = dragWindow.offsetHeight;
			initialMouseX = e.clientX;
			initialMouseY = e.clientY;

			// 聚焦窗口
			focusWindow(windowId);

			// 添加全局事件监听器
			document.addEventListener('mousemove', drag);
			document.addEventListener('mouseup', stopDrag);

			e.preventDefault();
			e.stopPropagation();
		}

		// 计算器功能
		function calcInput(value) {
			const display = document.getElementById('calc-display');
			if (display.textContent === '0' && value !== '.') {
				display.textContent = value;
			} else {
				display.textContent += value;
			}
		}

		function calcClear() {
			document.getElementById('calc-display').textContent = '0';
		}

		function calcCalculate() {
			const display = document.getElementById('calc-display');
			try {
				// 替换显示用的符号为JavaScript可计算的符号
				let expression = display.textContent.replace(/×/g, '*').replace(/÷/g, '/');
				const result = eval(expression);
				display.textContent = result;
			} catch (e) {
				display.textContent = '错误';
			}
		}

		// 文件管理器功能
		function fmRenderFiles(path) {
			const container = document.getElementById('fm-files');
			if (container == null)
				return;
			container.innerHTML = '';

			let current = fileSystem.root;
			path.forEach(dir => {
				current = current.children.find(f => f.name === dir);
			});

			current.children.forEach(item => {
				const fileEl = document.createElement('div');
				fileEl.className = 'fm-file';
				fileEl.innerHTML = `
                    <img src="data:image/svg+xml;base64,${item.type === 'folder' ?
						'PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBkPSJNNDE2IDIxMmMwLTU4LjktNDcuMS0xMDYtMTA2LTEwNkgxMDRDNDUuMSAxMDYgMCAxNTMuMSAwIDIxMnYyMDBjMCA1OC45IDQ1LjEgMTA2IDEwNCAxMDZoMzA2YzU4LjkgMCAxMDYtNDcuMSAxMDYtMTA2VjIxMnoiIGZpbGw9IiNmZmYiIG9wYWNpdHk9Ii40Ii8+PHBhdGggZD0iTTQxNiAyMTJjMC01OC45LTQ3LjEtMTA2LTEwNi0xMDZIMjIydjMxMmgzMDRjNTguOSAwIDEwNi00Ny4xIDEwNi0xMDZWMjEyeiIgZmlsbD0iI2ZmZiIvPjwvc3ZnPg==' :
						'PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBkPSJNMzg0IDBIMTI4QzkzLjEgMCA2NCAyOS4xIDY0IDY0djM4NGMwIDM0LjkgMjkuMSA2NCA2NCA2NGgzNTVjMzUuNSAwIDY0LTI4LjUgNjQtNjRWMTI4TDM4NCAwem0xMjggNDQ4YzAgOC44LTcuMiAxNi0xNiAxNkgxMjhjLTguOCAwLTE2LTcuMi0xNi0xNlY2NGMwLTguOCA3LjItMTYgMTYtMTZoMjI0djExMmMwIDE3LjcgMTQuMyAzMiAzMiAzMmgxMjh2Mjg4eiIgZmlsbD0iI2ZmZiIvPjwvc3ZnPg=='
					}" alt="${item.type === 'folder' ? '文件夹' : '文件'}">
                    <span>${item.name}</span>
                `;
				if (item.type === 'folder') {
					fileEl.onclick = () => fmOpenFolder([...path, item.name]);
				}
				container.appendChild(fileEl);
			});
		}

		function fmOpenFolder(path) {
			fmRenderFiles(path);
		}

		function fmCreateFolder() {
			const folderName = prompt('请输入文件夹名称');
			if (folderName) {
				fileSystem.root.children.push({
					name: folderName,
					type: 'folder',
					children: []
				});
				fmRenderFiles([]);
			}
		}

		function fmUploadFile() {
			alert('文件上传功能需要后端支持，此处为演示');
		}

		// 多标签记事本功能
		function notepadNewTab() {
			const tabId = 'tab-' + Date.now();
			notepadTabs.push({
				id: tabId,
				title: '未命名',
				content: ''
			});

			// 添加标签页头
			const tabsContainer = document.getElementById('notepad-tabs');
			const tabEl = document.createElement('div');
			tabEl.className = 'tab';
			tabEl.textContent = '未命名';
			tabEl.dataset.tabid = tabId;
			tabEl.onclick = () => notepadSwitchTab(tabId);
			tabsContainer.appendChild(tabEl);

			// 添加内容区
			const contentsContainer = document.getElementById('notepad-contents');
			const contentEl = document.createElement('textarea');
			contentEl.className = 'notepad-content';
			contentEl.id = `notepad-content-${tabId}`;
			contentEl.placeholder = "在这里输入文本...";
			contentEl.addEventListener('input', () => {
				const tab = notepadTabs.find(t => t.id === tabId);
				if (tab) {
					tab.content = contentEl.value;
					if (contentEl.value.includes('\n')) {
						const firstLine = contentEl.value.split('\n')[0];
						if (firstLine.length > 0 && firstLine.length < 20) {
							tab.title = firstLine;
							document.querySelector(`.tab[data-tabid="${tabId}"]`).textContent = firstLine;
						}
					}
				}
			});
			contentsContainer.appendChild(contentEl);

			notepadSwitchTab(tabId);
		}

		function notepadSwitchTab(tabId) {
			// 隐藏所有内容
			document.querySelectorAll('.notepad-content').forEach(el => {
				el.style.display = 'none';
				el.classList.remove('active');
			});
			// 取消所有标签激活状态
			document.querySelectorAll('.tab').forEach(el => {
				el.classList.remove('active');
			});

			// 显示选中内容
			const contentEl = document.getElementById(`notepad-content-${tabId}`);
			if (contentEl) {
				contentEl.style.display = 'block';
				contentEl.classList.add('active');
			}

			// 设置标签激活状态
			const tabEl = document.querySelector(`.tab[data-tabid="${tabId}"]`);
			if (tabEl) {
				tabEl.classList.add('active');
			}

			activeNotepadTab = tabId;
		}

		// 主题切换功能
		function changeTheme(themeName) {
			document.body.className = themeName;
			localStorage.setItem('currentTheme', themeName);

			// 更新窗口颜色
			document.querySelectorAll('.window').forEach(window => {
				window.style.backgroundColor = getComputedStyle(document.body).getPropertyValue('--window-bg');
			});
		}

		// 壁纸切换功能
		function changeWallpaper(type) {
			const wallpaper = document.getElementById('wallpaper');
			wallpaper.className = type + '-wallpaper';
			localStorage.setItem('currentWallpaper', type);
		}
	</script>
</body>

</html>